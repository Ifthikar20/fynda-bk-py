{% extends "blog/base.html" %}

{% block content %}
<!-- Blog Header -->
<section class="blog-header">
    <h1 class="blog-title">The Edit</h1>
    <p class="blog-subtitle">
        Stories, insights, and discoveries from the world of fashion.
        Curated by editors who believe style is personal.
    </p>
</section>

{% if posts %}
<!-- Featured Article (First Post) -->
{% with featured=posts.0 %}
<article class="featured-article">
    <a href="{% url 'blog:post_detail' featured.slug %}">
        {% if featured.featured_image %}
        <img src="{{ featured.featured_image.url }}" alt="{{ featured.title }}">
        {% else %}
        <img src="https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=1200&h=750&fit=crop"
            alt="{{ featured.title }}">
        {% endif %}

        {% if featured.category %}
        <span class="category">{{ featured.category.name }}</span>
        {% endif %}

        <h2>{{ featured.title }}</h2>

        {% if featured.meta_description %}
        <p class="excerpt">{{ featured.meta_description }}</p>
        {% else %}
        <p class="excerpt">{{ featured.content|striptags|truncatewords:40 }}</p>
        {% endif %}

        <div class="meta">
            Published on {{ featured.published_date|date:"F j, Y" }}{% if featured.author %} Â· By {{
            featured.author.get_full_name|default:featured.author.email }}{% endif %}
        </div>
    </a>
</article>
{% endwith %}

<!-- Article Grid -->
<section class="articles-grid">
    {% for post in posts|slice:"1:" %}
    <article class="article-card">
        <a href="{% url 'blog:post_detail' post.slug %}">
            {% if post.featured_image %}
            <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
            {% else %}
            <img src="https://images.unsplash.com/photo-1445205170230-053b83016050?w=400&h=500&fit=crop"
                alt="{{ post.title }}">
            {% endif %}

            {% if post.category %}
            <span class="category">{{ post.category.name }}</span>
            {% endif %}

            <h3>{{ post.title }}</h3>

            {% if post.meta_description %}
            <p class="excerpt">{{ post.meta_description|truncatewords:20 }}</p>
            {% else %}
            <p class="excerpt">{{ post.content|striptags|truncatewords:20 }}</p>
            {% endif %}

            <div class="meta">{{ post.published_date|date:"M j, Y" }}</div>
        </a>
    </article>
    {% endfor %}
</section>

{% else %}
<section class="blog-header">
    <p class="blog-subtitle">No articles published yet. Check back soon for fashion insights and style inspiration.</p>
</section>
{% endif %}

<!-- Pagination -->
{% if is_paginated %}
<nav class="pagination">
    {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">Previous</a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
    {% if page_obj.number == num %}
    <span class="current">{{ num }}</span>
    {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} <a href="?page={{ num }}">{{ num }}</a>
        {% endif %}
        {% endfor %}

        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Next</a>
        {% endif %}
</nav>
{% endif %}
{% endblock %}