{% extends "blog/base.html" %}
{% load static %}

{% block seo %}
{% include "blog/includes/seo_meta.html" with post=post %}
{% endblock %}

{% block content %}
<article>
    <!-- Article Header -->
    <header class="article-header">
        {% if post.category %}
        <a href="{% url 'blog:category_posts' post.category.slug %}" class="article-category">{{ post.category.name
            }}</a>
        {% endif %}

        <h1 class="article-title">{{ post.title }}</h1>

        <div class="article-meta">
            Published on {{ post.published_date|date:"F j, Y" }}
            {% if post.author %}
            <br>Authored by <span class="author">{{ post.author.get_full_name|default:post.author.email }}</span>
            {% endif %}
        </div>
    </header>

    <!-- Featured Image (only if exists) -->
    {% if post.featured_image %}
    <figure class="featured-image">
        <img src="{{ post.featured_image.url }}" alt="{{ post.title }}">
        {% if post.category %}
        <figcaption class="image-caption">{{ post.category.name }}</figcaption>
        {% endif %}
    </figure>
    {% endif %}

    <!-- Editorial Disclosure -->
    <div class="article-body">
        <p class="editorial-note">
            All products are hand-picked by our editorial team. We may earn a commission on the sale of these products.
        </p>
    </div>

    <!-- Article Body -->
    <div class="article-body">
        {{ post.content|safe }}
    </div>

    <!-- Content Sections (Brand Showcases, etc.) -->
    {% for section in post.sections.all %}
    <section class="content-section {% if section.section_type == 'brand_showcase' %}brand-showcase{% endif %}">
        {% if section.title %}
        <h2 class="section-title">{{ section.title }}</h2>
        {% endif %}

        {% if section.subtitle %}
        <p class="section-subtitle">{{ section.subtitle }}</p>
        {% endif %}

        {% if section.content %}
        <div class="section-content">{{ section.content|safe }}</div>
        {% endif %}

        {% if section.products.exists %}
        <div class="product-grid">
            {% for product in section.products.all %}
            <a href="{{ product.link }}" class="product-card">
                <div class="product-image">
                    <img src="{{ product.image.url }}" alt="{{ product.product_name }}">
                </div>
                <div class="product-info">
                    <span class="product-price">
                        {% if product.is_on_sale %}
                        <span class="original-price">{{ product.price }}</span>
                        <span class="sale-price">{{ product.sale_price }}</span>
                        {% else %}
                        {{ product.price }}
                        {% endif %}
                    </span>
                    <span class="product-brand">{{ product.brand }}</span>
                    <span class="product-name">{{ product.product_name }}</span>
                    {% if product.retailer %}
                    <span class="product-retailer">FROM {{ product.retailer|upper }}</span>
                    {% endif %}
                </div>
            </a>
            {% endfor %}
        </div>
        {% endif %}
    </section>
    {% endfor %}

    <!-- Tags -->
    {% if post.tags.exists %}
    <div class="article-body">
        <div class="article-tags">
            {% for tag in post.tags.all %}
            <a href="{% url 'blog:tag_posts' tag.slug %}" class="tag">{{ tag.name }}</a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</article>

<!-- Related Articles -->
{% if related_posts %}
<section class="related-section">
    <h2 class="section-title">Continue Reading</h2>
    <div class="related-grid">
        {% for related in related_posts %}
        <a href="{% url 'blog:post_detail' related.slug %}" class="related-card">
            {% if related.featured_image %}
            <img src="{{ related.featured_image.url }}" alt="{{ related.title }}">
            {% endif %}
            <h3>{{ related.title }}</h3>
            <span class="date">{{ related.published_date|date:"M j, Y" }}</span>
        </a>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}